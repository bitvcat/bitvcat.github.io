<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="803px" preserveAspectRatio="none" style="width:550px;height:803px;" version="1.1" viewBox="0 0 550 803" width="550px" zoomAndPan="magnify"><defs><filter height="300%" id="f14kz4k8nwk8as" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFBBBB" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="35.5" y="403.4922"/><rect fill="#FFBBBB" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400.5" y="122.5625"/><rect fill="#E9967A" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400.5" y="584.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="40" y1="40.2969" y2="346.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="40" x2="40" y1="346.3594" y2="374.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="40" y1="374.3594" y2="514.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="40" x2="40" y1="514.7578" y2="555.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="40" y1="555.5625" y2="760.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="40.2969" y2="346.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="405" x2="405" y1="346.3594" y2="374.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="374.3594" y2="514.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="405" x2="405" y1="514.7578" y2="555.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="555.5625" y2="760.2266"/><rect fill="#FEFECE" filter="url(#f14kz4k8nwk8as)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="12" y="24.9951">Worker</text><rect fill="#FEFECE" filter="url(#f14kz4k8nwk8as)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="5" y="759.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="12" y="779.2217">Worker</text><rect fill="#FEFECE" filter="url(#f14kz4k8nwk8as)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="371" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="378" y="24.9951">Socket</text><rect fill="#FEFECE" filter="url(#f14kz4k8nwk8as)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="371" y="759.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="378" y="779.2217">Socket</text><rect fill="#FFBBBB" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="35.5" y="403.4922"/><rect fill="#FFBBBB" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400.5" y="122.5625"/><rect fill="#E9967A" filter="url(#f14kz4k8nwk8as)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="400.5" y="584.6953"/><rect fill="#EEEEEE" filter="url(#f14kz4k8nwk8as)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="543.5" x="0" y="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="543.5" y1="70.8633" y2="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="543.5" y1="73.8633" y2="73.8633"/><rect fill="#EEEEEE" filter="url(#f14kz4k8nwk8as)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="234.25" y="60.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="240.25" y="76.3638">接收连接</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="452.5" y1="109.5625" y2="109.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="452.5" y1="109.5625" y2="122.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="452.5" y1="122.5625" y2="122.5625"/><polygon fill="#A80036" points="421.5,118.5625,411.5,122.5625,421.5,126.5625,417.5,122.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="417.5" y="104.4966">socket_server_poll</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="410.5" x2="452.5" y1="156.6953" y2="156.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="452.5" y1="156.6953" y2="169.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="452.5" y1="169.6953" y2="169.6953"/><polygon fill="#A80036" points="421.5,165.6953,411.5,169.6953,421.5,173.6953,417.5,169.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="417.5" y="151.6294">report_accept</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="410.5" x2="452.5" y1="188.6953" y2="188.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="452.5" x2="452.5" y1="188.6953" y2="201.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405.5" x2="452.5" y1="201.6953" y2="201.6953"/><polygon fill="#A80036" points="415.5,197.6953,405.5,201.6953,415.5,205.6953,411.5,201.6953" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M302,209.6953 L302,264.6953 L504,264.6953 L504,219.6953 L494,209.6953 L302,209.6953 " fill="#90EE90" filter="url(#f14kz4k8nwk8as)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M494,209.6953 L494,219.6953 L504,219.6953 L494,209.6953 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="308" y="226.7622">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="419" y="226.7622">PACCEPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="308" y="241.895">表示新的连接已被接收</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="308" y="257.0278">只是未注册的epoll中</text><polygon fill="#A80036" points="51.5,291.2266,41.5,295.2266,51.5,299.2266,47.5,295.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="45.5" x2="404.5" y1="295.2266" y2="295.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="57.5" y="290.1606">forward_message(SKYNET_SOCKET_TYPE_ACCPET)</text><rect fill="#EEEEEE" filter="url(#f14kz4k8nwk8as)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="543.5" x="0" y="323.793"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="543.5" y1="323.793" y2="323.793"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="543.5" y1="326.793" y2="326.793"/><rect fill="#EEEEEE" filter="url(#f14kz4k8nwk8as)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="234.25" y="313.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="240.25" y="329.2935">打开连接</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="40.5" x2="87.5" y1="390.4922" y2="390.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="87.5" x2="87.5" y1="390.4922" y2="403.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="87.5" y1="403.4922" y2="403.4922"/><polygon fill="#A80036" points="56.5,399.4922,46.5,403.4922,56.5,407.4922,52.5,403.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="52.5" y="385.4263">socket_server_start</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="87.5" y1="437.625" y2="437.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="87.5" x2="87.5" y1="437.625" y2="450.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="87.5" y1="450.625" y2="450.625"/><polygon fill="#A80036" points="56.5,446.625,46.5,450.625,56.5,454.625,52.5,450.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="52.5" y="432.5591">send_request('S')</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="45.5" x2="87.5" y1="469.625" y2="469.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="87.5" x2="87.5" y1="469.625" y2="482.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="40.5" x2="87.5" y1="482.625" y2="482.625"/><polygon fill="#A80036" points="50.5,478.625,40.5,482.625,50.5,486.625,46.5,482.625" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="393.5,502.7578,403.5,506.7578,393.5,510.7578,397.5,506.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="40.5" x2="399.5" y1="506.7578" y2="506.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="47.5" y="501.6919">&lt;&lt;pipe&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="25" x="210.5" y="538.9683">pipe</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="452.5" y1="571.6953" y2="571.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="452.5" y1="571.6953" y2="584.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="452.5" y1="584.6953" y2="584.6953"/><polygon fill="#A80036" points="421.5,580.6953,411.5,584.6953,421.5,588.6953,417.5,584.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="417.5" y="566.6294">ctrl_cmd</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="410.5" x2="452.5" y1="618.8281" y2="618.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="452.5" y1="618.8281" y2="631.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="452.5" y1="631.8281" y2="631.8281"/><polygon fill="#A80036" points="421.5,627.8281,411.5,631.8281,421.5,635.8281,417.5,631.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="417.5" y="613.7622">start_socket</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="410.5" x2="452.5" y1="650.8281" y2="650.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="452.5" x2="452.5" y1="650.8281" y2="663.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405.5" x2="452.5" y1="663.8281" y2="663.8281"/><polygon fill="#A80036" points="415.5,659.8281,405.5,663.8281,415.5,667.8281,411.5,663.8281" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M291,671.8281 L291,711.8281 L516,711.8281 L516,681.8281 L506,671.8281 L291,671.8281 " fill="#90EE90" filter="url(#f14kz4k8nwk8as)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M506,671.8281 L506,681.8281 L516,681.8281 L506,671.8281 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="297" y="688.895">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="408" y="688.895">CONNECTED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="297" y="704.0278">新连接fd已注册到epoll中</text><polygon fill="#A80036" points="51.5,738.2266,41.5,742.2266,51.5,746.2266,47.5,742.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="45.5" x2="404.5" y1="742.2266" y2="742.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="57.5" y="737.1606">forward_message(SKYNET_SOCKET_TYPE_CONNECT)</text><!--MD5=[ccabcd62131e1404263fd75b773448b4]
@startuml
participant Worker
participant Socket

== 接收连接 ==
Socket -> Socket ++ #FFBBBB: socket_server_poll
Socket -> Socket : report_accept
return
note over Socket #lightgreen: 此时socket状态为 **PACCEPT**\n表示新的连接已被接收\n只是未注册的epoll中
Socket - -> Worker: forward_message(SKYNET_SOCKET_TYPE_ACCPET)


== 打开连接 ==
...
Worker -> Worker ++ #FFBBBB: socket_server_start
Worker -> Worker: send_request('S')
return

Worker - -> Socket: <<pipe>>
... pipe ...

Socket -> Socket ++ #DarkSalmon: ctrl_cmd
Socket -> Socket: start_socket
return
note over Socket #lightgreen: 此时socket状态为 **CONNECTED**\n新连接fd已注册到epoll中
Socket - -> Worker: forward_message(SKYNET_SOCKET_TYPE_CONNECT)
@enduml

PlantUML version 1.2020.20beta11(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>