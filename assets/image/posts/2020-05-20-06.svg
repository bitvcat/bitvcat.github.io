<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="789px" preserveAspectRatio="none" style="width:615px;height:789px;" version="1.1" viewBox="0 0 615 789" width="615px" zoomAndPan="magnify"><defs><filter height="300%" id="fmr7xet12wn95" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFBBBB" filter="url(#fmr7xet12wn95)" height="151.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="100.5" y="122.5625"/><rect fill="#AACCCC" filter="url(#fmr7xet12wn95)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="105.5" y="164.6953"/><rect fill="#E9967A" filter="url(#fmr7xet12wn95)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="465.5" y="470.2969"/><rect fill="#FFFFFF" filter="url(#fmr7xet12wn95)" height="169.6016" style="stroke: #000000; stroke-width: 2.0;" width="538" x="60" y="559.4297"/><rect fill="#FFFFFF" height="69.0703" style="stroke: none; stroke-width: 1.0;" width="538" x="60" y="659.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="105" x2="105" y1="40.2969" y2="400.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="105" x2="105" y1="400.3594" y2="441.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="105" x2="105" y1="441.1641" y2="746.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470" x2="470" y1="40.2969" y2="400.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="470" x2="470" y1="400.3594" y2="441.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470" x2="470" y1="441.1641" y2="746.0313"/><rect fill="#FEFECE" filter="url(#fmr7xet12wn95)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="70" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="77" y="24.9951">Worker</text><rect fill="#FEFECE" filter="url(#fmr7xet12wn95)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="70" y="745.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="77" y="765.0264">Worker</text><rect fill="#FEFECE" filter="url(#fmr7xet12wn95)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="436" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="443" y="24.9951">Socket</text><rect fill="#FEFECE" filter="url(#fmr7xet12wn95)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="436" y="745.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="443" y="765.0264">Socket</text><rect fill="#FFBBBB" filter="url(#fmr7xet12wn95)" height="151.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="100.5" y="122.5625"/><rect fill="#AACCCC" filter="url(#fmr7xet12wn95)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="105.5" y="164.6953"/><rect fill="#E9967A" filter="url(#fmr7xet12wn95)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="465.5" y="470.2969"/><rect fill="#EEEEEE" filter="url(#fmr7xet12wn95)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="608" x="0" y="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="608" y1="70.8633" y2="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="608" y1="73.8633" y2="73.8633"/><rect fill="#EEEEEE" filter="url(#fmr7xet12wn95)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="266.5" y="60.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="272.5" y="76.3638">发起连接</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="105.5" x2="152.5" y1="109.5625" y2="109.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="152.5" x2="152.5" y1="109.5625" y2="122.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="152.5" y1="122.5625" y2="122.5625"/><polygon fill="#A80036" points="121.5,118.5625,111.5,122.5625,121.5,126.5625,117.5,122.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="117.5" y="104.4966">socket_server_connect</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="110.5" x2="157.5" y1="151.6953" y2="151.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157.5" x2="157.5" y1="151.6953" y2="164.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="116.5" x2="157.5" y1="164.6953" y2="164.6953"/><polygon fill="#A80036" points="126.5,160.6953,116.5,164.6953,126.5,168.6953,122.5,164.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="122.5" y="146.6294">open_request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="115.5" x2="157.5" y1="198.8281" y2="198.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157.5" x2="157.5" y1="198.8281" y2="211.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="116.5" x2="157.5" y1="211.8281" y2="211.8281"/><polygon fill="#A80036" points="126.5,207.8281,116.5,211.8281,126.5,215.8281,122.5,211.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="122.5" y="193.7622">reserve_id</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="115.5" x2="157.5" y1="230.8281" y2="230.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157.5" x2="157.5" y1="230.8281" y2="243.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="110.5" x2="157.5" y1="243.8281" y2="243.8281"/><polygon fill="#A80036" points="120.5,239.8281,110.5,243.8281,120.5,247.8281,116.5,243.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="110.5" x2="152.5" y1="272.9609" y2="272.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="152.5" x2="152.5" y1="272.9609" y2="285.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="105.5" x2="152.5" y1="285.9609" y2="285.9609"/><polygon fill="#A80036" points="115.5,281.9609,105.5,285.9609,115.5,289.9609,111.5,285.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="117.5" y="267.895">send_request('O')</text><path d="M5,293.9609 L5,318.9609 L203,318.9609 L203,303.9609 L193,293.9609 L5,293.9609 " fill="#90EE90" filter="url(#fmr7xet12wn95)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M193,293.9609 L193,303.9609 L203,303.9609 L193,293.9609 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="11" y="311.0278">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="122" y="311.0278">RESERVE</text><rect fill="#EEEEEE" filter="url(#fmr7xet12wn95)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="608" x="0" y="348.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="608" y1="348.6602" y2="348.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="608" y1="351.6602" y2="351.6602"/><rect fill="#EEEEEE" filter="url(#fmr7xet12wn95)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="266.5" y="338.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="272.5" y="354.1606">打开连接</text><polygon fill="#A80036" points="458.5,388.3594,468.5,392.3594,458.5,396.3594,462.5,392.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="105.5" x2="464.5" y1="392.3594" y2="392.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="112.5" y="387.2935">&lt;&lt;pipe&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="25" x="275.5" y="424.5698">pipe</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="470.5" x2="517.5" y1="457.2969" y2="457.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="517.5" x2="517.5" y1="457.2969" y2="470.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="476.5" x2="517.5" y1="470.2969" y2="470.2969"/><polygon fill="#A80036" points="486.5,466.2969,476.5,470.2969,486.5,474.2969,482.5,470.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="482.5" y="452.231">ctrl_cmd</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="475.5" x2="517.5" y1="504.4297" y2="504.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="517.5" x2="517.5" y1="504.4297" y2="517.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="476.5" x2="517.5" y1="517.4297" y2="517.4297"/><polygon fill="#A80036" points="486.5,513.4297,476.5,517.4297,486.5,521.4297,482.5,517.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="482.5" y="499.3638">open_socket</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="517.5" y1="536.4297" y2="536.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="517.5" x2="517.5" y1="536.4297" y2="549.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="470.5" x2="517.5" y1="549.4297" y2="549.4297"/><polygon fill="#A80036" points="480.5,545.4297,470.5,549.4297,480.5,553.4297,476.5,549.4297" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M60,559.4297 L126,559.4297 L126,566.4297 L116,576.4297 L60,576.4297 L60,559.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="169.6016" style="stroke: #000000; stroke-width: 2.0;" width="538" x="60" y="559.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="75" y="572.4966">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="141" y="571.6401">[连接成功(通常是在服务器和客户在同一台主机上时发生)]</text><path d="M356,581.5625 L356,621.5625 L581,621.5625 L581,591.5625 L571,581.5625 L356,581.5625 " fill="#90EE90" filter="url(#fmr7xet12wn95)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M571,581.5625 L571,591.5625 L581,591.5625 L571,581.5625 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="362" y="598.6294">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="473" y="598.6294">CONNECTED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="362" y="613.7622">表示连接已建立</text><polygon fill="#A80036" points="116.5,647.9609,106.5,651.9609,116.5,655.9609,112.5,651.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="110.5" x2="469.5" y1="651.9609" y2="651.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="122.5" y="646.895">forward_message(SKYNET_SOCKET_TYPE_CONNECT)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="60" x2="598" y1="660.9609" y2="660.9609"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="65" y="671.1714">[failed]</text><path d="M352,679.7656 L352,719.7656 L584,719.7656 L584,689.7656 L574,679.7656 L352,679.7656 " fill="#FFFF00" filter="url(#fmr7xet12wn95)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M574,679.7656 L574,689.7656 L584,689.7656 L574,679.7656 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="358" y="696.8325">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="469" y="696.8325">CONNECTING</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="358" y="711.9653">表示正在连接中</text><!--MD5=[951a2caa8d965ad0e5505b6ed83b3c7d]
@startuml
participant Worker
participant Socket

== 发起连接 ==
Worker -> Worker ++ #FFBBBB: socket_server_connect
Worker -> Worker ++ #AACCCC: open_request
Worker -> Worker : reserve_id
return
Worker -> Worker - -: send_request('O')
note over Worker #lightgreen: 此时socket状态为 **RESERVE**

== 打开连接 ==
Worker - -> Socket: <<pipe>>
... pipe ...

Socket -> Socket ++ #DarkSalmon: ctrl_cmd
Socket -> Socket: open_socket
return

alt 连接成功(通常是在服务器和客户在同一台主机上时发生)
note over Socket #lightgreen: 此时socket状态为 **CONNECTED**\n表示连接已建立
Socket - -> Worker: forward_message(SKYNET_SOCKET_TYPE_CONNECT)
else failed
note over Socket #Yellow: 此时socket状态为 **CONNECTING**\n表示正在连接中
end
@enduml

PlantUML version 1.2020.20beta11(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>