<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1180px" preserveAspectRatio="none" style="width:625px;height:1180px;" version="1.1" viewBox="0 0 625 1180" width="625px" zoomAndPan="magnify"><defs><filter height="300%" id="fxud309b5igpk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFBBBB" filter="url(#fxud309b5igpk)" height="151.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="97.5" y="122.5625"/><rect fill="#FFBBBB" filter="url(#fxud309b5igpk)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="97.5" y="780.2969"/><rect fill="#E9967A" filter="url(#fxud309b5igpk)" height="91.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="462.5" y="427.1641"/><rect fill="#E9967A" filter="url(#fxud309b5igpk)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="462.5" y="961.5"/><rect fill="#FFFFFF" filter="url(#fxud309b5igpk)" height="211.7344" style="stroke: #000000; stroke-width: 2.0;" width="551" x="57" y="489.2969"/><rect fill="#FFFFFF" height="98.2031" style="stroke: none; stroke-width: 1.0;" width="551" x="57" y="602.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="102" y1="40.2969" y2="357.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="102" x2="102" y1="357.2266" y2="398.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="102" y1="398.0313" y2="891.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="102" x2="102" y1="891.5625" y2="932.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="102" y1="932.3672" y2="1137.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="467" y1="40.2969" y2="357.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="467" x2="467" y1="357.2266" y2="398.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="467" y1="398.0313" y2="891.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="467" x2="467" y1="891.5625" y2="932.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="467" y1="932.3672" y2="1137.0313"/><rect fill="#FEFECE" filter="url(#fxud309b5igpk)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="67" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="74" y="24.9951">Worker</text><rect fill="#FEFECE" filter="url(#fxud309b5igpk)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="67" y="1136.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="74" y="1156.0264">Worker</text><rect fill="#FEFECE" filter="url(#fxud309b5igpk)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="433" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="440" y="24.9951">Socket</text><rect fill="#FEFECE" filter="url(#fxud309b5igpk)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="433" y="1136.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="440" y="1156.0264">Socket</text><rect fill="#FFBBBB" filter="url(#fxud309b5igpk)" height="151.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="97.5" y="122.5625"/><rect fill="#FFBBBB" filter="url(#fxud309b5igpk)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="97.5" y="780.2969"/><rect fill="#E9967A" filter="url(#fxud309b5igpk)" height="91.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="462.5" y="427.1641"/><rect fill="#E9967A" filter="url(#fxud309b5igpk)" height="67.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="462.5" y="961.5"/><rect fill="#EEEEEE" filter="url(#fxud309b5igpk)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="618" x="0" y="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="618" y1="70.8633" y2="70.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="618" y1="73.8633" y2="73.8633"/><rect fill="#EEEEEE" filter="url(#fxud309b5igpk)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="271.5" y="60.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="277.5" y="76.3638">创建监听</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="102.5" x2="149.5" y1="109.5625" y2="109.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="109.5625" y2="122.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="122.5625" y2="122.5625"/><polygon fill="#A80036" points="118.5,118.5625,108.5,122.5625,118.5,126.5625,114.5,122.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="114.5" y="104.4966">socket_server_listen</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="107.5" x2="149.5" y1="156.6953" y2="156.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="156.6953" y2="169.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="169.6953" y2="169.6953"/><polygon fill="#A80036" points="118.5,165.6953,108.5,169.6953,118.5,173.6953,114.5,169.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="114.5" y="151.6294">do_listen</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="107.5" x2="149.5" y1="198.8281" y2="198.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="198.8281" y2="211.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="211.8281" y2="211.8281"/><polygon fill="#A80036" points="118.5,207.8281,108.5,211.8281,118.5,215.8281,114.5,211.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="114.5" y="193.7622">reserve_id</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="107.5" x2="149.5" y1="240.9609" y2="240.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="240.9609" y2="253.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="253.9609" y2="253.9609"/><polygon fill="#A80036" points="118.5,249.9609,108.5,253.9609,118.5,257.9609,114.5,253.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="114.5" y="235.895">send_request('L')</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="149.5" y1="272.9609" y2="272.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="149.5" x2="149.5" y1="272.9609" y2="285.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="102.5" x2="149.5" y1="285.9609" y2="285.9609"/><polygon fill="#A80036" points="112.5,281.9609,102.5,285.9609,112.5,289.9609,108.5,285.9609" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M5,293.9609 L5,318.9609 L196,318.9609 L196,303.9609 L186,293.9609 L5,293.9609 " fill="#FEDCBA" filter="url(#fxud309b5igpk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M186,293.9609 L186,303.9609 L196,303.9609 L186,293.9609 " fill="#FEDCBA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="11" y="311.0278">此时socket状态为 RESERVE</text><polygon fill="#A80036" points="455.5,345.2266,465.5,349.2266,455.5,353.2266,459.5,349.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="102.5" x2="461.5" y1="349.2266" y2="349.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="109.5" y="344.1606">&lt;&lt;pipe&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="25" x="272.5" y="381.437">pipe</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="467.5" x2="514.5" y1="414.1641" y2="414.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514.5" x2="514.5" y1="414.1641" y2="427.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473.5" x2="514.5" y1="427.1641" y2="427.1641"/><polygon fill="#A80036" points="483.5,423.1641,473.5,427.1641,483.5,431.1641,479.5,427.1641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="479.5" y="409.0981">ctrl_cmd</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="514.5" y1="461.2969" y2="461.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514.5" x2="514.5" y1="461.2969" y2="474.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473.5" x2="514.5" y1="474.2969" y2="474.2969"/><polygon fill="#A80036" points="483.5,470.2969,473.5,474.2969,483.5,478.2969,479.5,474.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="479.5" y="456.231">listen_socket</text><path d="M57,489.2969 L123,489.2969 L123,496.2969 L113,506.2969 L57,506.2969 L57,489.2969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="211.7344" style="stroke: #000000; stroke-width: 2.0;" width="551" x="57" y="489.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="72" y="502.3638">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="138" y="501.5073">[ok]</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="472.5" x2="514.5" y1="517.4297" y2="517.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="514.5" x2="514.5" y1="517.4297" y2="530.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="467.5" x2="514.5" y1="530.4297" y2="530.4297"/><polygon fill="#A80036" points="477.5,526.4297,467.5,530.4297,477.5,534.4297,473.5,530.4297" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M368,538.4297 L368,593.4297 L563,593.4297 L563,548.4297 L553,538.4297 L368,538.4297 " fill="#90EE90" filter="url(#fxud309b5igpk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M553,538.4297 L553,548.4297 L563,548.4297 L553,538.4297 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="374" y="555.4966">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="485" y="555.4966">PLISTEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="374" y="570.6294">表示监听已准备就绪</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="374" y="585.7622">只是未注册的epoll中</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57" x2="608" y1="603.8281" y2="603.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="62" y="614.0386">[failed]</text><polygon fill="#A80036" points="113.5,634.7656,103.5,638.7656,113.5,642.7656,109.5,638.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="466.5" y1="638.7656" y2="638.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="119.5" y="633.6997">forward_message(SKYNET_SOCKET_TYPE_ERROR)</text><path d="M337,651.7656 L337,691.7656 L594,691.7656 L594,661.7656 L584,651.7656 L337,651.7656 " fill="#FFFF00" filter="url(#fxud309b5igpk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M584,651.7656 L584,661.7656 L594,661.7656 L584,651.7656 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="343" y="668.8325">监听失败，socket状态切换为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="519" y="668.8325">INVALID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="343" y="683.9653">(一般不会出现)</text><rect fill="#EEEEEE" filter="url(#fxud309b5igpk)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="618" x="0" y="728.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="618" y1="728.5977" y2="728.5977"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="618" y1="731.5977" y2="731.5977"/><rect fill="#EEEEEE" filter="url(#fxud309b5igpk)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="271.5" y="718.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="277.5" y="734.0981">启动监听</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="102.5" x2="149.5" y1="767.2969" y2="767.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="767.2969" y2="780.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="780.2969" y2="780.2969"/><polygon fill="#A80036" points="118.5,776.2969,108.5,780.2969,118.5,784.2969,114.5,780.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="114.5" y="762.231">socket_server_start</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="107.5" x2="149.5" y1="814.4297" y2="814.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="149.5" x2="149.5" y1="814.4297" y2="827.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="149.5" y1="827.4297" y2="827.4297"/><polygon fill="#A80036" points="118.5,823.4297,108.5,827.4297,118.5,831.4297,114.5,827.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="114.5" y="809.3638">send_request('S')</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="149.5" y1="846.4297" y2="846.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="149.5" x2="149.5" y1="846.4297" y2="859.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="102.5" x2="149.5" y1="859.4297" y2="859.4297"/><polygon fill="#A80036" points="112.5,855.4297,102.5,859.4297,112.5,863.4297,108.5,859.4297" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="455.5,879.5625,465.5,883.5625,455.5,887.5625,459.5,883.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="102.5" x2="461.5" y1="883.5625" y2="883.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="109.5" y="878.4966">&lt;&lt;pipe&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="25" x="272.5" y="915.7729">pipe</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="467.5" x2="514.5" y1="948.5" y2="948.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514.5" x2="514.5" y1="948.5" y2="961.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473.5" x2="514.5" y1="961.5" y2="961.5"/><polygon fill="#A80036" points="483.5,957.5,473.5,961.5,483.5,965.5,479.5,961.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="479.5" y="943.4341">ctrl_cmd</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="514.5" y1="995.6328" y2="995.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514.5" x2="514.5" y1="995.6328" y2="1008.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473.5" x2="514.5" y1="1008.6328" y2="1008.6328"/><polygon fill="#A80036" points="483.5,1004.6328,473.5,1008.6328,483.5,1012.6328,479.5,1008.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="479.5" y="990.5669">start_socket</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="472.5" x2="514.5" y1="1027.6328" y2="1027.6328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="514.5" x2="514.5" y1="1027.6328" y2="1040.6328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="467.5" x2="514.5" y1="1040.6328" y2="1040.6328"/><polygon fill="#A80036" points="477.5,1036.6328,467.5,1040.6328,477.5,1044.6328,473.5,1040.6328" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M373,1048.6328 L373,1088.6328 L558,1088.6328 L558,1058.6328 L548,1048.6328 L373,1048.6328 " fill="#90EE90" filter="url(#fxud309b5igpk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M548,1048.6328 L548,1058.6328 L558,1058.6328 L548,1048.6328 " fill="#90EE90" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="379" y="1065.6997">此时socket状态为</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="490" y="1065.6997">LISTEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="379" y="1080.8325">监听fd已注册到epoll中</text><polygon fill="#A80036" points="113.5,1115.0313,103.5,1119.0313,113.5,1123.0313,109.5,1119.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="466.5" y1="1119.0313" y2="1119.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="119.5" y="1113.9653">forward_message(SKYNET_SOCKET_TYPE_CONNECT)</text><!--MD5=[1954b9a45e71bcf0ffb2eb368a8b5219]
@startuml
participant Worker
participant Socket

== 创建监听 ==
Worker -> Worker ++ #FFBBBB: socket_server_listen
Worker -> Worker: do_listen
Worker -> Worker: reserve_id
Worker -> Worker: send_request('L')
return
note over Worker #FEDCBA: 此时socket状态为 RESERVE

Worker - -> Socket: <<pipe>>
... pipe ...

Socket -> Socket ++ #DarkSalmon: ctrl_cmd
Socket -> Socket: listen_socket
alt ok
return
note over Socket #lightgreen: 此时socket状态为 **PLISTEN**\n表示监听已准备就绪\n只是未注册的epoll中
else failed
Socket - -> Worker: forward_message(SKYNET_SOCKET_TYPE_ERROR)
note over Socket #yellow: 监听失败，socket状态切换为 **INVALID**\n(一般不会出现)
end

== 启动监听 ==
Worker -> Worker ++ #FFBBBB: socket_server_start
Worker -> Worker: send_request('S')
return

Worker - -> Socket: <<pipe>>
... pipe ...

Socket -> Socket ++ #DarkSalmon: ctrl_cmd
Socket -> Socket: start_socket
return
note over Socket #lightgreen: 此时socket状态为 **LISTEN**\n监听fd已注册到epoll中
Socket - -> Worker: forward_message(SKYNET_SOCKET_TYPE_CONNECT)
@enduml

PlantUML version 1.2020.20beta11(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>