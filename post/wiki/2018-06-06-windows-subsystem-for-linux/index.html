<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>在win10的linux子系统下搭建开发环境 - Domi●Cat</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Domicat" /><meta name="description" content="在win10系统下，安装ubuntu linux子系统，并搭建linux开发环境。" />

  <meta name="keywords" content="Domi的个人站点, domicat" />






<meta name="generator" content="Hugo 0.44" />


<link rel="canonical" href="http://shuimu98.gitHub.io/post/wiki/2018-06-06-windows-subsystem-for-linux/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="在win10的linux子系统下搭建开发环境" />
<meta property="og:description" content="在win10系统下，安装ubuntu linux子系统，并搭建linux开发环境。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shuimu98.gitHub.io/post/wiki/2018-06-06-windows-subsystem-for-linux/" />



<meta property="article:published_time" content="2018-06-06T19:16:00&#43;08:00"/>

<meta property="article:modified_time" content="2018-06-06T19:16:00&#43;08:00"/>











<meta itemprop="name" content="在win10的linux子系统下搭建开发环境">
<meta itemprop="description" content="在win10系统下，安装ubuntu linux子系统，并搭建linux开发环境。">


<meta itemprop="datePublished" content="2018-06-06T19:16:00&#43;08:00" />
<meta itemprop="dateModified" content="2018-06-06T19:16:00&#43;08:00" />
<meta itemprop="wordCount" content="3081">



<meta itemprop="keywords" content="环境搭建," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="在win10的linux子系统下搭建开发环境"/>
<meta name="twitter:description" content="在win10系统下，安装ubuntu linux子系统，并搭建linux开发环境。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">DomiCat</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/links/">
        <li class="mobile-menu-item">Links</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">DomiCat</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/links/">Links</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">在win10的linux子系统下搭建开发环境</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-06-06 </span>
        
        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#故事的起因">故事的起因</a></li>
<li><a href="#linux子系统">linux子系统</a>
<ul>
<li><a href="#1-开启开发者模式">1、开启开发者模式</a></li>
<li><a href="#2-安装linux-子系统">2、安装linux 子系统</a></li>
</ul></li>
<li><a href="#配置开发环境">配置开发环境</a>
<ul>
<li><a href="#1-修改源">1、修改源</a></li>
<li><a href="#2-ubuntu系统安装中文支持">2、Ubuntu系统安装中文支持</a></li>
<li><a href="#3-安装各种组件">3、安装各种组件</a></li>
</ul></li>
<li><a href="#windows与linux子系统之间的文件共享">windows与linux子系统之间的文件共享</a></li>
<li><a href="#conemu作为linux子系统终端">ConEmu作为linux子系统终端</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h3 id="故事的起因">故事的起因</h3>

<p>在很久很久之前（也就三五年前- - ），我所有的跨平台开发的套路都是：在windows系统系统搞一个虚拟机，然后装个linux系统，再接着就是各种yum、make&hellip;，永无止境。最后就是windows和linux之间文件共享的搞法了，最初我用的是linux mount windows系统下的共享文件夹，在很长一段时间内都用得挺满意，但是渐渐的问题就出现了，在linux下面make的时候，经常会出现<code>cannot allocate memory</code>，我猜想是linux在快速创建文件时，无法及时在windows共享文件夹下生成文件。</p>

<p>为了解决上面的问题，我尝试采用samba服务，把linux下面的文件映射到windows系统下，但是这种方式也有缺点：</p>

<ul>
<li>一是samba服务的安装比较繁琐，不管是linux还是windows</li>
<li>二是windows下访问文件有时候速度会比较卡顿，经常导致sublime无法及时打开文件而卡顿</li>
</ul>

<h3 id="linux子系统">linux子系统</h3>

<p>在我尝试使用NFS来共享linux文件夹时，我搜到了一些关于windows 的linux系统相关的教程，所以，我也打算尝试使用一下这个win10的新特性。</p>

<h4 id="1-开启开发者模式">1、开启开发者模式</h4>

<p>我的win10版本：win 10 家庭中文版，版本1803，系统版本：17134.81，算是最新的版本了。</p>

<p>开启步骤：设置 &ndash;&gt; 更新和安全 &ndash;&gt; 开发者选项 &ndash;&gt; 选择开发者模式，然后重启系统。</p>

<h4 id="2-安装linux-子系统">2、安装linux 子系统</h4>

<p><del><strong>提醒：</strong>在这之前，先改变一下应用的安装路径，因为在应用商城安装的应用，默认是放在c盘下的<code>C:\Users\YourName\AppData\Local\Packages</code>，这样会占用很多C盘空间，所以，要先更改下应用的安装位置。</del>
~~设置 &ndash;&gt; 搜索【存储】 &ndash;&gt; 点击【更改新内容的保存位置】 &ndash;&gt; 修改【新的应用将保存到：】，然后选择一个盘后应用。~
<del>会弹出一个提示框，点击确定就可以了。</del>
<del>linux子系统必须安装到系统盘，所以上面的方法只能对普通应用有效。</del></p>

<p>下面就要开始安装linux子系统了：</p>

<p>首先，打开powershell，输入<code>bash</code>，或者按<code>win+q</code>快捷键后搜索bash</p>

<p><img src="/images/posts/sublinux/powershell.png" alt="打开powershell" />
<img src="/images/posts/sublinux/winq.png" alt="Win+Q" /></p>

<p>然后，按照提示，在浏览器输入网址<code>https://aka.ms/wslstore</code>，会打开应用商城，然后选择一个linux系统安装，这里我选择我比较熟悉的ubuntu。</p>

<p><img src="/images/posts/sublinux/mricosoftstore.png" alt="打开powershell" /></p>

<p>下载安装成功后，启动ubuntu，第一次启动时，需要等待几分钟，ubuntu系统初始化需要一些时间。接着会提示你输入一个账号名，并给你的用户名一个密码（注意：这里不是输入windows系统的账号和密码，是要给你的ubuntu子系统创建一个账号，另外需要注意的是，这个子系统的root密码在每次启动时随机生成的，所以一般我们用sudo就可以了，尽量不用root账号。）</p>

<p><img src="/images/posts/sublinux/installing.png" alt="ubuntu 安装" /></p>

<p>安装好的子系统路径如图所示：
<img src="/images/posts/sublinux/ubuntu.png" alt="ubuntu 安装路径" /></p>

<p>好了，到这里为止，linux子系统就已经安装完成了。安装的ubuntu版本如下：</p>

<pre><code># 内核版本
domi@Domicat:~$ uname -a
Linux Domicat 4.4.0-17134-Microsoft #81-Microsoft Sun May 20 01:14:00 PST 2018 x86_64 x86_64 x86_64 GNU/Linux

# ubuntu版本
domi@Domicat:~$ cat /etc/issue
Ubuntu 16.04.4 LTS \n \l

domi@Domicat:~$
domi@Domicat:~$ cat /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION=&quot;Ubuntu 16.04.4 LTS&quot;
</code></pre>

<p>我们可以在powershell输入命令<code>wslconfig /list</code>，查看已安装的linux子系统。
<img src="/images/posts/sublinux/wslconfig.png" alt="wlsconfig" /></p>

<h3 id="配置开发环境">配置开发环境</h3>

<p>目前我的开发需要的组件：</p>

<ul>
<li>svn</li>
<li>git</li>
<li>ssh</li>
<li>mysql</li>
<li>make</li>
<li>gcc、g++</li>
<li>vim</li>
<li>sqlite3</li>
<li>tmux</li>
<li>sysv-rc-conf（ubuntu下的chkconfig）</li>
<li>readline</li>
</ul>

<h4 id="1-修改源">1、修改源</h4>

<p>在安装这些组件之前，首要修改下载源为阿里云(<strong>一定义要注意ubuntu版本代号与源的代号一致，不然apt的时候各种奇葩错误</strong>)：</p>

<p>首先，备份。</p>

<pre><code>cd /etc/apt/
sudo cp sources.list sources.list.backup
</code></pre>

<p>然后，清空之前的源，然后添加阿里云源。</p>

<pre><code>sudo vim sources.list

# 输入阿里云源
#deb
deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse
deb http://archive.canonical.com/ubuntu/ xenial partner
</code></pre>

<p>最后update。</p>

<pre><code>sudo apt update
</code></pre>

<h4 id="2-ubuntu系统安装中文支持">2、Ubuntu系统安装中文支持</h4>

<p>可以参考<a href="http://www.4wei.cn/archives/1001458">英文Ubuntu系统安装中文支持，中文UTF-8</a>。</p>

<p>第一步：安装中文包</p>

<p><code>sudo apt install -y language-pack-zh-hans language-pack-zh-hans-base</code></p>

<p>第二步：修改环境变量</p>

<p>编辑.bashrc文件（<code>vim .bashrc</code>），在文件最后添加：</p>

<pre><code>export LANG=&quot;zh_CN.UTF-8&quot;
export LANGUAGE=&quot;zh_CN:zh:en_US:en&quot;
</code></pre>

<p>然后，输入命令<code>source .bashrc</code>，让环境变量生效。</p>

<p>第三步：重新设置本地配置</p>

<p><code>sudo dpkg-reconfigure locales</code></p>

<h4 id="3-安装各种组件">3、安装各种组件</h4>

<ul>
<li><p>svn</p>

<pre><code>sudo apt install subversion
svn --version

svn，版本 1.9.3 (r1718519)
   编译于 Aug 10 2017，16:59:15 在 x86_64-pc-linux-gnu
</code></pre></li>

<li><p>ssh，安装好的子系统默认已经安装了ssh组件</p></li>

<li><p>git</p>

<pre><code>sudo apt install git
gi --version #git version 2.7.4
</code></pre></li>

<li><p>msyql &amp; sqlite3 （<strong>注意：</strong> mysqld服务需要手动启动，无法开机自启）</p>

<pre><code>sudo apt autorem
sudo apt install mysql-server #注意：安装过程中会提示你输入root用户的密码
sudo apt install sqlite3
</code></pre>

<p><img src="/images/posts/sublinux/mysql5.7.png" alt="mysql 5.7" /></p></li>

<li><p>gcc &amp; g++ &amp; make</p>

<pre><code>sudo apt install gcc
sudo apt install g++
sudo apt install make
gcc --version #gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609
g++ --version #g++ (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609
make --version #GNU Make 4.1
</code></pre></li>

<li><p>vim &amp; tmux，默认已经安装了</p></li>

<li><p>dash换成bash</p>

<p>参考<a href="https://blog.csdn.net/gatieme/article/details/52136411">这篇文章</a>。
因为ubuntu默认的shell是<code>dash</code>，而我已经习惯了bash，所以换成了bash。</p>

<pre><code>ls -l /bin/sh #查看shell
sudo dpkg-reconfigure dash #选择否
ls -l /bin/sh #此时已经切换成bash
</code></pre></li>

<li><p>sysv-rc-conf</p>

<p>参考<a href="http://blog.51cto.com/12058118/1858680">这篇文章</a>，具体不再赘述。</p>

<pre><code>sudo apt install sysv-rc-conf
sudo ln -s /usr/sbin/sysv-rc-conf /usr/sbin/chkconfig #因为已经习惯了centos的chkconfig
</code></pre></li>

<li><p>readline</p>

<pre><code>sudo apt install libreadline-dev
</code></pre></li>

<li><p>软连接(因为默认路径太长了，搜索文件不太好查找，所以将项目的目录软链接到其他目录)</p>

<pre><code>mklink /J d:\h5-server C:\Users\Domi\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\home\domi\server
</code></pre></li>
</ul>

<p><strong>最后</strong>，在安装的过程中，可能某些更改没有立即生效，而子系统又没有重启这种操作，所以，可以重启windows系统，一般我遇到的问题重启后都OK了。</p>

<p>例如： gcc链接stdc++.a的时候，明明已经安装了g++，但是链接的时候依然报错，尝试很多办法都无法解决，重启windows系统后就解决了。</p>

<h3 id="windows与linux子系统之间的文件共享">windows与linux子系统之间的文件共享</h3>

<p>最开始，我修改linux子系统的项目源代码文件时，直接就是在windows下修改、新建文件。
但是，这里就出现了问题，仅仅是修改已经存在的文件，确实能够操作成功，但是如果是在windows下新建文件，在linux系统下却无法看到文件。
经过google后，原来上面这种操作是不允许的。</p>

<p><strong>正确的文件共享方式是</strong>：</p>

<p>通过linux子系统下的<code>mnt目录</code>（挂载目录）来实现两个系统之间的文件共享，<a href="https://blogs.msdn.microsoft.com/commandline/2016/11/17/do-not-change-linux-files-using-windows-apps-and-tools/">微软官方的博客</a>有明确的说明，并且给出了正确的方式。
主要原则就是：<strong>不要在windows下直接修改或者新建linux子系统内的文件</strong>。</p>

<p>举个栗子：</p>

<p>我的项目文件夹在<code>D:\proj-h5\trunk\server</code>，我在windows下新建一个文本<code>哈哈.txt</code>，此时在linux系统下，进入路径<code>/mnt/d/proj-h5/trunk/server</code>，此时就能看见新建的文件。
同样的，我在linux下修改这个文件，在windows下查看，修改也是成功的。
另外，为了在linux子系统下快速访问共享文件夹，可以将<code>/mnt</code>下的目录软链接到linux下的用户目录，例如:</p>

<p><code>domi@Domicat:~$ ln -s /mnt/d/proj-h5/trunk/server ~/h5-server</code></p>

<h3 id="conemu作为linux子系统终端">ConEmu作为linux子系统终端</h3>

<p>ConEmu支持分屏，也支持多标签，这对开发来说是很方便的。我现在使用的版本是：<code>180528 preview</code>。这个版本已经支持了中文，下面就是ConEmu的设置了。</p>

<p><img src="/images/posts/sublinux/conemu.png" alt="ConEmu" /></p>

<p>这里有一个小问题，方向键会失效，在某些情况下无法使用方向键移动光标，比如在上面的<code>sysv-rc-conf</code>工作界面中，无法使用方向键。但是旧的版本可以，
不过旧的版本有一个更蛋疼的问题，粘贴时无法粘贴全部的内容，而且粘贴后内容顺序会被打断，所以，建议使用新的版本。</p>

<p>为了解决方向键失效的问题，官方给了一些解决方案，具体请参考<a href="https://conemu.github.io/en/BashOnWindows.html#connector">这里</a>，这里贴一下我的配置。</p>

<p><img src="/images/posts/sublinux/conemu1.png" alt="ConEmu" /></p>

<p>不过，还是有一些小瑕疵，比如tmux分屏后，分屏的分割线会莫名其妙消失或者重叠。所以，我还是采用了第一种方式，在需要使用方向键的时候直接用默认的wsl终端。</p>

<p>最后来一张截图，项目成功运行在linux子系统下：</p>

<p><img src="/images/posts/sublinux/project.png" alt="项目运行中" /></p>

    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Domicat</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2018-06-06</span>
  </p>
  
  
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/wiki/2018-07-10-ftp-server-on-linux/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">在linux下搭建ftp服务</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/tcp-ip/2018-03-24-tcp-ip-protocol-6/">
            <span class="next-text nav-default">TCP/IP协议族详解（六）</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '2018-06-06 19:16:00 \x2b0800 \x2b0800',
    title: '在win10的linux子系统下搭建开发环境',
    link: decodeURI(location.href),
    desc: '故事的起因 在很久很久之前（也就三五年前- - ），我所有的跨平台开发的套路都是：在windows系统系统搞一个虚拟机，然后装个linux系统，再',
    owner: 'shuimu98',
    repo: 'shuimu98.github.io',
    oauth: {
      client_id: 'af5065a1372570c7babc',
      client_secret: '3bd955012d21847887f0d3d4f9ea3c2cbc2b7e10'
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shui_mu98@163.com" class="iconfont icon-email" title="email"></a>
      <a href="http://github.com/shuimu98" class="iconfont icon-github" title="github"></a>
  <a href="http://shuimu98.gitHub.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Domicat</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>








</body>
</html>
