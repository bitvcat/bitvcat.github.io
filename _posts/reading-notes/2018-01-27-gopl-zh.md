---
layout: post
title:  "读书笔记 ——《Go语言圣经》"
date:   2018-01-27
excerpt: "Go语言圣经 《The Go Programming Language》 中文版本笔记"
tag:
- 读书笔记
comments: true
---

本书中文版，点[这里](https://books.studygolang.com/gopl-zh/index.html)。


## 第1章：入门

1. 命令行参数

	`os`包以跨平台的方式，提供了一些与操作系统交互的函数和变量。程序的命令行参数可从os包的Args变量获取；os包外部使用os.Args访问该变量。**os.Args的第一个元素**，`os.Args[0]`, 是命令本身的名字（例如：`D:\Github\xlsxconv\xlsxconv.exe`）。

2. `bufio`包，它使处理输入和输出方便又高效。Scanner类型是该包最有用的特性之一，它读取输入并将其拆成行或单词；通常是处理行形式的输入最简单的方法。它是按**流**模式读取输入，并根据需要拆分成多个行。理论上，可以处理任意数量的输入数据。还有另一个方法，就是一口气把全部输入数据读到内存中，一次分割为多行，然后处理它们，需要使用`ReadFile`（来自于`io/ioutil`）和`strings.Split`。
	
	```go
	input := bufio.NewScanner(os.Stdin)
	for input.Scan() {
	   	// TODO ...
	}
	```
3. `Printf`格式字符串：

	| 占位符        	   	| 备注           									|
	| :---------------: |:-------------------------------------------------	|
	|%d          		|十进制整数|
	|%x, %o, %b  		|十六进制，八进制，二进制整数。|
	|%f, %g, %e  		|浮点数： 3.141593 3.141592653589793 3.141593e+00|
	|%t          		|布尔：true或false|
	|%c          		|字符（rune） (Unicode码点)|
	|%s          		|字符串|
	|%q          		|带双引号的字符串"abc"或带单引号的字符'c'|
	|%v          		|变量的自然形式（natural format）|
	|%T          		|变量的类型|
	|%%          		|字面上的百分号标志（无操作数）|
	{: rules="all" frame="border"}

4. 如果你的操作系统是Mac OS X或者Linux，那么在运行命令的末尾加上一个&符号，即可让程序简单地跑在后台，windows下可以在另外一个命令行窗口去运行这个程序。
5. Go语言里的switch可以不带操作对象；可以直接罗列多种条件，像其它语言里面的多个if else一样。这种形式叫做无tag switch(tagless switch)；这和switch true是等价的。

	```go
	func Signum(x int) int {
	    switch {
	    case x > 0:
	        return +1
	    default:
	        return 0
	    case x < 0:
	        return -1
	    }
	}
	```
6. 指针是可见的内存地址，&操作符可以返回一个变量的内存地址，并且*操作符可以获取指针指向的变量内容，但是在Go语言里没有指针运算，也就是不能像c语言里可以对指针进行加或减操作(可以通过unsafe包进行指针运算，具体参考[我的golang每日笔记](http://domicat.me/daily-notes-golang/#%E6%8C%87%E9%92%88))。

## 第2章：程序结构
1. go有25个关键字，30多个内建的预定义字，可以参考源码的`Go\src\builtin\builtin.go`。
2. go推荐使用 **驼峰式** 命名。
3. Go语言主要有四种类型的声明语句：var、const、type和func，分别对应变量、常量、类型和函数实体对象的声明。
4. 用`new`创建变量和普通变量声明语句方式创建变量没有什么区别，除了不需要声明一个临时变量的名字外，我们还可以在表达式中使用new(T)。换言之，new函数类似是一种语法糖，而不是一个新的基础概念。所以下面的两个`newInt`作用是相同的：

	```go
	func newInt() *int {
	    return new(int)
	}
	
	func newInt() *int {
	    var dummy int
	    return &dummy
	}	
	```

5. 如果两个类型都是空的，也就是说类型的大小是0，例如struct{}和 [0]int, 有可能有相同的地址。所以**谨慎使用大小为0的类型**，因为如果类型的大小为0的话，可能导致Go语言的自动垃圾回收器有不同的行为，具体请查看runtime.SetFinalizer函数相关文档。
6. 编译器会自动选择在栈上还是在堆上分配局部变量的存储空间，**这个选择并不是由用var还是new声明变量的方式决定的**（这与C语言是有区别的）。当返回一个局部变量的指针时，用Go语言的术语说，这个**局部变量从函数中逃逸**了。记住的是，**逃逸的变量需要额外分配内存**，同时对性能的优化可能会产生细微的影响。具体看下面的例子：

	```go
	var global *int
	
	func f() {
	    var x int
	    x = 1
	    global = &x // 此时x被分配到堆上
	}
	
	func g() {
	    y := new(int)	// 此时y分配在栈上
	    *y = 1
	}
	```

7. 数值变量也可以支持++递增和--递减语句，注意：go只有**后置**没有前置，因此`++i`这种是错误的。另外：自增和自减是语句，而不是表达式，因此`x = i++`之类的表达式是错误的。
8. nil可以赋值给任何指针或引用类型的变量（slice、map、chan）。