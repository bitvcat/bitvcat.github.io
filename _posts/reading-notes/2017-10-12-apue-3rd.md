---
layout: post
title:  "读书笔记 ——《Unix环境高级编程》"
date:   2017-10-12
excerpt: "《Unix环境高级编程》(第3版)的笔记，主要记录每个章节的重点部分，以及需要特别注意的细节。"
tag:
- 读书笔记
comments: true
---

本书一共21章。

## 第1章：UNIX基础知识

1. `/etc/passwd文件`为unix的口令文件，口令文件中的登陆项由7个以冒号分隔的字段组成，依次是：登录名、加密口令、数字用户id(UID)、组id(GID)、注释字段、起始目录以及使用的shell程序。其中，真实的用户密码存放在`/etc/shadow`中，组名存放在`/etc/group`中。

		domi:x:500:500::/home/domi:/bin/zsh
		git:x:502:502::/home/git:/bin/bash
2. unix文件系统是目录和文件的一种层次结构，所有东西的起点是称为“根”（`root`）的目录，这个目录的名称是一个字符“`/`”。
3. 文件描述符是一个小的非负整数，内核用来标示一个特定进程正在访问（例如：读文件、写文件、新建文件）的文件。
4. 当运行一个新程序时，shell为其打开3个文件描述符，即标准输入（stdin）、标准输出（stdout）和标准错误（stderr）。可以重定向其中的一个或所有这3个描述符到某个文件。shell把文件描述符0与进程的标准输入关联，描述符1与进程的标注输出关联，描述符2与进程的标准错误关联。
		ls > list.txt

5. 一个进程内的所有线程共享同一地址空间、文件描述符、栈以及进程相关属性。
6. 当unix系统函数出错时，通常会返回一个负值，而且整数变量errno通常被设置为具有特殊信息的值。
7. 系统调用（system call）和C库函数调用的区别：
![系统调用和库函数调用](/images/posts/syscall_clibcall.jpg)

## 第2章：UNIX标准及实现

1. 两个比较常见的标准,参考[这篇文章](http://blog.csdn.net/skylj0209/article/details/3071507)

	- **ANSI C**：这一标准是 ANSI（美国国家标准局）于 1989 年制定的 C 语言标准。 后来被 ISO（国际标准化组织）接受为标准，因此也称为 **ISO C**。它的目标是**为各种操作系统上的 C 程序提供可移植性保证，而不仅仅限于 UNIX**。
	- **POSIX**：该标准最初由 IEEE 开发的标准族，部分已经被 ISO 接受为国际标准。POSIX.1 和 POSIX.2 分别定义了 POSIX 兼容操作系统的 C 语言系统接口 以及 shell 和工具标准。这两个标准是通常提到的标准。POSIX 表示可移植操作系统接口（Portable Operating System Interface ，缩写为 POSIX 是为了读音更 像 UNIX）。塔的目标是**为了提高 UNIX 环境下应用程序的可移植性，而不仅仅局限于UNIX**。
2. 头文件<sys/types.h>定义了某些与实现相关的数据类型，它们被称为**基本系统数据类型**。下表列出了常用的基本系统数据类型。
![常用的基本系统数据类型](/images/posts/primitive_system_data_type.jpg)

3. 头文件列表

![c99标准头文件](/images/posts/c99标准头文件.jpg)
![posix必需头文件](/images/posts/posix必需头文件.jpg)
![posix可选头文件](/images/posts/posix可选头文件.jpg)

## 第3章：文件I/O

1. 文件描述符标志只用于一个进程的一个描述符，而文件状态标志应用于指向该文件表项的任何进程中的描述符。
2. 任何多于一个函数调用的操作都不是原子操作。因为在两个函数调用之间，内核可能会挂起进程。
3. 原子操作指多步操作组成一个操作。执行原子操作，要么执行完所有操作，要么一个操作都不执行。
4. 在`/dev/fd`目录下，有名为0、1、2等的文件，打开文件/dev/fd/n等效于复制描述符（假定描述符n是打开的）。

## 第4章：文件和目录

1. unix文件类型

	- 普通文件
	- 目录文件
	- 块特殊文件，这种类型的文件提供对设备（如磁盘）带缓冲的访问。
	- 字符特殊文件，这种类型的文件提供对设备（如磁盘）不带缓冲的访问。
	- FIFO，用于进程间通讯，命名管道。
	- 套接字，用于进程间网络通讯。
	- 符号链接，用于指向另一个文件，类似快捷方式。

2. 文件的访问权限 ： 每个文件有**9**个访问权限位，可以用`chmod`命令来修改文件的访问权限位，权限位可以分为三组：

	- 用户读、用户写、用户执行，用`u (user)`表示
	- 组读、组写、组执行，用`g (group)`表示
	- 其他读、其他写、其他执行，用`o (other)` 表示

> 关于文件权限：[这篇文章](http://www.cnblogs.com/123-/p/4189072.html)有比较详细易懂的介绍。

## 第5章：标准IO库

1. 当用标准IO库创建或者打开一个文件时，我们就使用了一个流与文件相关联了。

2. 对一个进程预定义了3个流，并且这3个流可以自动被进程使用，它们是：标准输入、标准输出和标准错误，这些流所引用的文件与文件描述符`STDIN_FILENO`,`STDOUT_FILENO`,`STDERR_FILENO`所引用的相同，这三个标准IO流通过预定义文件指针 `stdin,stdout,stderr`加以引用，这三个文件指针定义在头文件`<stdio.h>`中。

3. 标准IO库提供的缓冲目的是为了尽可能减少使用`read`和`write`调用的次数，标准IO库提供三种缓冲类型：

	- 全缓冲，在填满缓冲区后才进行实际的IO操作
	- 行缓冲，在遇到换行符时，执行IO操作
	- 不带缓冲，不对字符进行缓冲操作存储

## 第6章：系统数据文件和信息

1. 时间和日期例程：unix内核提供的基本时间服务是计算UTC（世界标准时间）公元1970年1月1日00:00:00这一特定时间以来的经历过的秒数。

	~~~c
	#include<time.h>
	time_t time(time_t *calptr); // 返回unix时间戳
	~~~

2. 两个函数`localtime`和`gmtime`将日历时间（unix时间戳）转换成分解时间，并将结果存放在`struct tm`结构体中。
3. `localtime`和`gmtime`的区别是：前者将日历时间转换成本地时间，而后者则转换成世界标准时间（UTC）的**年、月、日、时、分、秒、周、日**分解结构。

![各个时间函数之间的关系](/images/posts/unix_time.jpg)

## 第7章：进程环境

1. 