---
title:  "深入理解skynet —— 网络"
date: 2020-05-20
tag:
- skynet
---

## 前言
当我们接触一些服务器项目时，会对其中的网络部分都会有“如临大敌”之感，但其实是我们在理解网络框架时把问题复杂化了，抑或是没有对网络框架划分出一个清晰的层次结构。当我遇到一个框架时，我采用“黑盒化”的一种方式，先把一些较为细节的部分想象成一个黑盒，把它“包”起来，然后对这些黑盒进行梳理，整理好整个框架的大致架构，在这个大框架的基础上再深入“黑盒中”，抽丝剥茧，从“黑盒”转变成“白盒”。当然，若配合现实例子会更好帮助理解。

接下来，带上上面的“利器”，进入到 skynet 的网络世界中吧。

## 网络框架
任何网络框架的核心工作内容其实很简单，即：**接收并读取 socket 中的数据并进行相应处理，然后写入处理后的返回消息**。只不过一个优秀的网络框架会提供更多的功能和细节优化，例如：socket 的管理、网络读写分离、读写数据缓存等等。skynet 的网络库同样如此，我们对其进行“黑盒化”之后，会得到三个部分：网络工作线程(`thread_socket`)、网络管理器(`socket_server`)

### 网络线程

## socket_server
### 管道
### 事件

## socket 封装
### socket 状态
### 写入队列
### dw_buffer

## 消息的封装
### skynet_message
### socket_message
### skynet_socket_message

## 网络处理
### 内部命令
### 消息读取
### 消息写入

## lua库
### socketdriver
### netpack

https://blog.codingnow.com/2019/11/skynet_socket_rawpointer.html